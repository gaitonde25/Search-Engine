b'Today is a holiday in the residence hall\xc2\xa0\xe2\x80\x94 Oleh arrived, in honor of which the girls gave him a string. Oleh liked the gift a lot, so he immediately thought up and offered you, his best friend, the following problem.'
b'You are given a string ss of length nn, which consists of the first 1717 lowercase Latin letters {aa, bb, cc, \xe2\x80\xa6\xe2\x80\xa6, pp, qq} and question marks. And qq queries. Each query is defined by a set of pairwise distinct lowercase first 1717 letters of the Latin alphabet, which can be used to replace the question marks in the string ss.'
b'The answer to the query is the sum of the number of distinct substrings that are palindromes over all strings that can be obtained from the original string ss by replacing question marks with available characters. The answer must be calculated modulo 998244353998244353.'
b'Pay attention! Two substrings are different when their start and end positions in the string are different. So, the number of different substrings that are palindromes for the string aba will be 44: a, b, a, aba.'
b'Consider examples of replacing question marks with letters. For example, from the string aba??ee when querying {aa, bb} you can get the strings ababaee or abaaaee but you cannot get the strings pizza,  abaee, abacaba, aba?fee, aba47ee, or abatree.'
b'Recall that a palindrome is a string that reads the same from left to right as from right to left.'
b'Input'
b'The first line contains a single integer nn (1\xe2\x89\xa4n\xe2\x89\xa410001\xe2\x89\xa4n\xe2\x89\xa41000)\xc2\xa0\xe2\x80\x94 the length of the string ss.'
b'The second line contains the string ss, which consists of nn lowercase Latin letters and question marks. It is guaranteed that all letters in the string belong to the set {aa, bb, cc, \xe2\x80\xa6\xe2\x80\xa6, pp, qq}.'
b'The third line contains a single integer qq (1\xe2\x89\xa4q\xe2\x89\xa42\xe2\x8b\x851051\xe2\x89\xa4q\xe2\x89\xa42\xe2\x8b\x85105)\xc2\xa0\xe2\x80\x94 the number of queries.'
b'This is followed by qq lines, each containing a single line tt\xc2\xa0\xe2\x80\x94 a set of characters that can replace question marks (1\xe2\x89\xa4|t|\xe2\x89\xa4171\xe2\x89\xa4|t|\xe2\x89\xa417). It is guaranteed that all letters in the string belong to the set {aa, bb, cc, \xe2\x80\xa6\xe2\x80\xa6, pp, qq} and occur at most once.'
b'Output'
b'For each query print one number\xc2\xa0\xe2\x80\x94 the total numbers of palindromic substrings in all strings that can be obtained from the string ss, modulo 998244353998244353.'
Tags
bitmasks, brute force, combinatorics, dp, math, strings, *2400

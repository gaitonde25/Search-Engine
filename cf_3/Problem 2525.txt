b'Alice and Bob want to play a game. They have nn colored paper strips; the ii-th strip is divided into aiai cells numbered from 11 to aiai. Each cell can have one of 33 colors.'
b"In the beginning of the game, Alice and Bob put nn chips, the ii-th chip is put in the aiai-th cell of the ii-th strip. Then they take turns, Alice is first. Each player during their turn has to choose one chip and move it 11, 22 or 33 cells backwards (i.\xe2\x80\x89e. if the current cell is xx, then the chip can be moved to the cell x\xe2\x88\x921x\xe2\x88\x921, x\xe2\x88\x922x\xe2\x88\x922 or x\xe2\x88\x923x\xe2\x88\x923). There are two restrictions: the chip cannot leave the borders of the strip (for example, if the current cell is 33, then you can't move the chip 33 cells backwards); and some moves may be prohibited because of color of the current cell (a matrix ff with size 3\xc3\x9733\xc3\x973 is given, where fi,j=1fi,j=1 if it is possible to move the chip jj cells backwards from the cell which has color ii, or fi,j=0fi,j=0 if such move is prohibited). The player who cannot make a move loses the game."
b"Initially some cells may be uncolored. Bob can color all uncolored cells as he wants (but he cannot leave any cell uncolored). Let's call a coloring good if Bob can win the game no matter how Alice acts, if the cells are colored according to this coloring. Two colorings are different if at least one cell is colored in different colors in these two colorings."
b'Bob wants you to calculate the number of good colorings. Can you do it for him?'
b'Since the answer can be really large, you have to print it modulo 998244353998244353.'
b'Input'
b'The first line contains one integer nn \xe2\x80\x94 the number of paper strips (1\xe2\x89\xa4n\xe2\x89\xa410001\xe2\x89\xa4n\xe2\x89\xa41000).'
b'The second line contains nn integers a1a1, a2a2, ..., anan (1\xe2\x89\xa4ai\xe2\x89\xa41091\xe2\x89\xa4ai\xe2\x89\xa4109), where aiai is the number of cells in the ii-th strip.'
b'The third line contains one integer mm (1\xe2\x89\xa4m\xe2\x89\xa410001\xe2\x89\xa4m\xe2\x89\xa41000) \xe2\x80\x94 the number of cells that are already colored.'
b'Then mm lines follow, each describing an already colored cell. The ii-th of these lines contains three integers xixi, yiyi and cici (1\xe2\x89\xa4xi\xe2\x89\xa4n1\xe2\x89\xa4xi\xe2\x89\xa4n, 1\xe2\x89\xa4yi\xe2\x89\xa4axi1\xe2\x89\xa4yi\xe2\x89\xa4axi, 1\xe2\x89\xa4ci\xe2\x89\xa431\xe2\x89\xa4ci\xe2\x89\xa43) denoting that the cell yiyi in the strip xixi has color cici. It is guaranteed that if i\xe2\x89\xa0ji\xe2\x89\xa0j, then either xi\xe2\x89\xa0xjxi\xe2\x89\xa0xj or yi\xe2\x89\xa0yjyi\xe2\x89\xa0yj (or both).'
b'Then 33 lines follow, ii-th line containing 33 numbers fi,1fi,1, fi,2fi,2, fi,3fi,3 (0\xe2\x89\xa4fi,j\xe2\x89\xa410\xe2\x89\xa4fi,j\xe2\x89\xa41). If fi,j=1fi,j=1, then it is possible to move the chip jj cells backwards from the cell having color ii; if fi,j=0fi,j=0, then such move is impossible.'
b'Output'
b'Print one integer: the number of good colorings, taken modulo 998244353998244353.'
Tags
dp, games, matrices, *2700
